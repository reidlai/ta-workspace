type: "application"
stack: "backend"
id: "ta-server"

tasks:
  build:
    command: "go"
    args:
      - "build"
      - "-o"
      - "ta-server.exe"
      - "."
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    outputs:
      - "ta-server.exe"
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"
    deps:
      - "test"
    local: true

  test:
    command: "go"
    args:
      - "test"
      - "."
      - "./cmd/..."
      - "./internal/..."
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    options:
      runInCI: true
      mergeArgs: "replace"
      mergeInputs: "replace"

  gen:
    command: "goa gen github.com/reidlai/ta-workspace/apps/ta-server/design"
    inputs:
      - "design/**/*.go"
      - "go.mod"

  run:
    command: "go run . api-server"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"
    local: true

  start:
    extends: "run"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"

  format:
    command: "goimports"
    args:
      - "-w"
      - "."
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    platform: "system"
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"

  lint:
    command: "go"
    args:
      - "run"
      - "github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
      - "run"
      - "-v"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"
    platform: "system"
