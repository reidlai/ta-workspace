type: "application"
id: "ta-server"

tasks:
  build:
    command: "npm run build"
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    outputs:
      - "ta-server.exe"
    local: true

  test:
    command: "npm run test"
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
    options:
      runInCI: true

  gen:
    command: "goa gen github.com/reidlai/ta-workspace/apps/ta-server/design"
    inputs:
      - "design/**/*.go"
      - "go.mod"

  run:
    command: "go run . api-server"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"
    local: true

  dev:
    extends: "run"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"

  lint:
    command: 'echo "Linting not configured for Go yet"'
    platform: "system"
