type: "application"
id: "ta-server"

tasks:
  build:
    command: "go"
    args:
      - "build"
      - "-o"
      - "ta-server.exe"
      - "."
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    outputs:
      - "ta-server.exe"
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"
    local: true

  test:
    command: "go"
    args:
      - "test"
      - "./..."
    platform: "system"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    options:
      runInCI: true
      mergeArgs: "replace"
      mergeInputs: "replace"

  gen:
    command: "goa gen github.com/reidlai/ta-workspace/apps/ta-server/design"
    inputs:
      - "design/**/*.go"
      - "go.mod"

  run:
    command: "go run . api-server"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"
    local: true

  dev:
    extends: "run"
    env:
      TA_SERVER_LOG_LEVEL: "DEBUG"
      TA_SERVER_LOG_FORMAT: "text"

  lint:
    command: "go"
    args:
      - "run"
      - "github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
      - "run"
    inputs:
      - "**/*.go"
      - "go.mod"
      - "go.sum"
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"
    platform: "system"
